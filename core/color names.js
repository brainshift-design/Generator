// const htmlColors = 
// [
//     {name: 'AliceBlue',            color: 'f0f8ff'},
//     {name: 'AntiqueWhite',         color: 'faebd7'},
//     {name: 'Aqua',                 color: '00ffff'},
//     {name: 'Aquamarine',           color: '7fffd4'},
//     {name: 'Azure',                color: 'f0ffff'},
//     {name: 'Beige',                color: 'f5f5dc'},
//     {name: 'Bisque',               color: 'ffe4c4'},
//     {name: 'Black',                color: '000000'},
//     {name: 'BlanchedAlmond',       color: 'ffebcd'},
//     {name: 'Blue',                 color: '0000ff'},
//     {name: 'BlueViolet',           color: '8a2be2'},
//     {name: 'Brown',                color: 'a52a2a'},
//     {name: 'BurlyWood',            color: 'deb887'},
//     {name: 'CadetBlue',            color: '5f9ea0'},
//     {name: 'Chartreuse',           color: '7fff00'},
//     {name: 'Chocolate',            color: 'd2691e'},
//     {name: 'Coral',                color: 'ff7f50'},
//     {name: 'CornflowerBlue',       color: '6495ed'},
//     {name: 'Cornsilk',             color: 'fff8dc'},
//     {name: 'Crimson',              color: 'dc143c'},
//     {name: 'Cyan',                 color: '00ffff'},
//     {name: 'DarkBlue',             color: '00008b'},
//     {name: 'DarkCyan',             color: '008b8b'},
//     {name: 'DarkGoldenRod',        color: 'b8860b'},
//     {name: 'DarkGray',             color: 'a9a9a9'},
//     {name: 'DarkGrey',             color: 'a9a9a9'},
//     {name: 'DarkGreen',            color: '006400'},
//     {name: 'DarkKhaki',            color: 'bdb76b'},
//     {name: 'DarkMagenta',          color: '8b008b'},
//     {name: 'DarkOliveGreen',       color: '556b2f'},
//     {name: 'DarkOrange',           color: 'ff8c00'},
//     {name: 'DarkOrchid',           color: '9932cc'},
//     {name: 'DarkRed',              color: '8b0000'},
//     {name: 'DarkSalmon',           color: 'e9967a'},
//     {name: 'DarkSeaGreen',         color: '8fbc8f'},
//     {name: 'DarkSlateBlue',        color: '483d8b'},
//     {name: 'DarkSlateGray',        color: '2f4f4f'},
//     {name: 'DarkSlateGrey',        color: '2f4f4f'},
//     {name: 'DarkTurquoise',        color: '00ced1'},
//     {name: 'DarkViolet',           color: '9400d3'},
//     {name: 'DeepPink',             color: 'ff1493'},
//     {name: 'DeepSkyBlue',          color: '00bfff'},
//     {name: 'DimGray',              color: '696969'},
//     {name: 'DimGrey',              color: '696969'},
//     {name: 'DodgerBlue',           color: '1e90ff'},
//     {name: 'FireBrick',            color: 'b22222'},
//     {name: 'FloralWhite',          color: 'fffaf0'},
//     {name: 'ForestGreen',          color: '228b22'},
//     {name: 'Fuchsia',              color: 'ff00ff'},
//     {name: 'Gainsboro',            color: 'dcdcdc'},
//     {name: 'GhostWhite',           color: 'f8f8ff'},
//     {name: 'Gold',                 color: 'ffd700'},
//     {name: 'GoldenRod',            color: 'daa520'},
//     {name: 'Gray',                 color: '808080'},
//     {name: 'Grey',                 color: '808080'},
//     {name: 'Green',                color: '008000'},
//     {name: 'GreenYellow',          color: 'adff2f'},
//     {name: 'HoneyDew',             color: 'f0fff0'},
//     {name: 'HotPink',              color: 'ff69b4'},
//     {name: 'IndianRed',            color: 'cd5c5c'},
//     {name: 'Indigo',               color: '4b0082'},
//     {name: 'Ivory',                color: 'fffff0'},
//     {name: 'Khaki',                color: 'f0e68c'},
//     {name: 'Lavender',             color: 'e6e6fa'},
//     {name: 'LavenderBlush',        color: 'fff0f5'},
//     {name: 'LawnGreen',            color: '7cfc00'},
//     {name: 'LemonChiffon',         color: 'fffacd'},
//     {name: 'LightBlue',            color: 'add8e6'},
//     {name: 'LightCoral',           color: 'f08080'},
//     {name: 'LightCyan',            color: 'e0ffff'},
//     {name: 'LightGoldenRodYellow', color: 'fafad2'},
//     {name: 'LightGray',            color: 'd3d3d3'},
//     {name: 'LightGrey',            color: 'd3d3d3'},
//     {name: 'LightGreen',           color: '90ee90'},
//     {name: 'LightPink',            color: 'ffb6c1'},
//     {name: 'LightSalmon',          color: 'ffa07a'},
//     {name: 'LightSeaGreen',        color: '20b2aa'},
//     {name: 'LightSkyBlue',         color: '87cefa'},
//     {name: 'LightSlateGray',       color: '778899'},
//     {name: 'LightSlateGrey',       color: '778899'},
//     {name: 'LightSteelBlue',       color: 'b0c4de'},
//     {name: 'LightYellow',          color: 'ffffe0'},
//     {name: 'Lime',                 color: '00ff00'},
//     {name: 'LimeGreen',            color: '32cd32'},
//     {name: 'Linen',                color: 'faf0e6'},
//     {name: 'Magenta',              color: 'ff00ff'},
//     {name: 'Maroon',               color: '800000'},
//     {name: 'MediumAquaMarine',     color: '66cdaa'},
//     {name: 'MediumBlue',           color: '0000cd'},
//     {name: 'MediumOrchid',         color: 'ba55d3'},
//     {name: 'MediumPurple',         color: '9370db'},
//     {name: 'MediumSeaGreen',       color: '3cb371'},
//     {name: 'MediumSlateBlue',      color: '7b68ee'},
//     {name: 'MediumSpringGreen',    color: '00fa9a'},
//     {name: 'MediumTurquoise',      color: '48d1cc'},
//     {name: 'MediumVioletRed',      color: 'c71585'},
//     {name: 'MidnightBlue',         color: '191970'},
//     {name: 'MintCream',            color: 'f5fffa'},
//     {name: 'MistyRose',            color: 'ffe4e1'},
//     {name: 'Moccasin',             color: 'ffe4b5'},
//     {name: 'NavajoWhite',          color: 'ffdead'},
//     {name: 'Navy',                 color: '000080'},
//     {name: 'OldLace',              color: 'fdf5e6'},
//     {name: 'Olive',                color: '808000'},
//     {name: 'OliveDrab',            color: '6b8e23'},
//     {name: 'Orange',               color: 'ffa500'},
//     {name: 'OrangeRed',            color: 'ff4500'},
//     {name: 'Orchid',               color: 'da70d6'},
//     {name: 'PaleGoldenRod',        color: 'eee8aa'},
//     {name: 'PaleGreen',            color: '98fb98'},
//     {name: 'PaleTurquoise',        color: 'afeeee'},
//     {name: 'PaleVioletRed',        color: 'db7093'},
//     {name: 'PapayaWhip',           color: 'ffefd5'},
//     {name: 'PeachPuff',            color: 'ffdab9'},
//     {name: 'Peru',                 color: 'cd853f'},
//     {name: 'Pink',                 color: 'ffc0cb'},
//     {name: 'Plum',                 color: 'dda0dd'},
//     {name: 'PowderBlue',           color: 'b0e0e6'},
//     {name: 'Purple',               color: '800080'},
//     {name: 'RebeccaPurple',        color: '663399'},
//     {name: 'Red',                  color: 'ff0000'},
//     {name: 'RosyBrown',            color: 'bc8f8f'},
//     {name: 'RoyalBlue',            color: '4169e1'},
//     {name: 'SaddleBrown',          color: '8b4513'},
//     {name: 'Salmon',               color: 'fa8072'},
//     {name: 'SandyBrown',           color: 'f4a460'},
//     {name: 'SeaGreen',             color: '2e8b57'},
//     {name: 'SeaShell',             color: 'fff5ee'},
//     {name: 'Sienna',               color: 'a0522d'},
//     {name: 'Silver',               color: 'c0c0c0'},
//     {name: 'SkyBlue',              color: '87ceeb'},
//     {name: 'SlateBlue',            color: '6a5acd'},
//     {name: 'SlateGray',            color: '708090'},
//     {name: 'SlateGrey',            color: '708090'},
//     {name: 'Snow',                 color: 'fffafa'},
//     {name: 'SpringGreen',          color: '00ff7f'},
//     {name: 'SteelBlue',            color: '4682b4'},
//     {name: 'Tan',                  color: 'd2b48c'},
//     {name: 'Teal',                 color: '008080'},
//     {name: 'Thistle',              color: 'd8bfd8'},
//     {name: 'Tomato',               color: 'ff6347'},
//     {name: 'Turquoise',            color: '40e0d0'},
//     {name: 'Violet',               color: 'ee82ee'},
//     {name: 'Wheat',                color: 'f5deb3'},
//     {name: 'White',                color: 'ffffff'},
//     {name: 'WhiteSmoke',           color: 'f5f5f5'},
//     {name: 'Yellow',               color: 'ffff00'},
//     {name: 'YellowGreen',          color: '9acd32'}
// ];



const htmlColors = 
[
    {name: 'AliceBlue',            color: [0.941, 0.973, 1.000]},
    {name: 'AntiqueWhite',         color: [0.980, 0.922, 0.843]},
    {name: 'Aqua',                 color: [0.000, 1.000, 1.000]},
    {name: 'Aquamarine',           color: [0.498, 1.000, 0.831]},
    {name: 'Azure',                color: [0.941, 1.000, 1.000]},
    {name: 'Beige',                color: [0.961, 0.961, 0.863]},
    {name: 'Bisque',               color: [1.000, 0.894, 0.769]},
    {name: 'Black',                color: [0.000, 0.000, 0.000]},
    {name: 'BlanchedAlmond',       color: [1.000, 0.922, 0.804]},
    {name: 'Blue',                 color: [0.000, 0.000, 1.000]},
    {name: 'BlueViolet',           color: [0.541, 0.169, 0.886]},
    {name: 'Brown',                color: [0.647, 0.165, 0.165]},
    {name: 'BurlyWood',            color: [0.871, 0.722, 0.529]},
    {name: 'CadetBlue',            color: [0.373, 0.620, 0.627]},
    {name: 'Chartreuse',           color: [0.498, 1.000, 0.000]},
    {name: 'Chocolate',            color: [0.824, 0.412, 0.118]},
    {name: 'Coral',                color: [1.000, 0.498, 0.314]},
    {name: 'CornflowerBlue',       color: [0.392, 0.584, 0.929]},
    {name: 'Cornsilk',             color: [1.000, 0.973, 0.863]},
    {name: 'Crimson',              color: [0.863, 0.078, 0.235]},
    {name: 'Cyan',                 color: [0.000, 1.000, 1.000]},
    {name: 'DarkBlue',             color: [0.000, 0.000, 0.545]},
    {name: 'DarkCyan',             color: [0.000, 0.545, 0.545]},
    {name: 'DarkGoldenRod',        color: [0.722, 0.525, 0.043]},
    {name: 'DarkGray',             color: [0.663, 0.663, 0.663]},
    {name: 'DarkGrey',             color: [0.663, 0.663, 0.663]},
    {name: 'DarkGreen',            color: [0.000, 0.392, 0.000]},
    {name: 'DarkKhaki',            color: [0.741, 0.718, 0.420]},
    {name: 'DarkMagenta',          color: [0.545, 0.000, 0.545]},
    {name: 'DarkOliveGreen',       color: [0.333, 0.420, 0.184]},
    {name: 'DarkOrange',           color: [1.000, 0.549, 0.000]},
    {name: 'DarkOrchid',           color: [0.600, 0.196, 0.800]},
    {name: 'DarkRed',              color: [0.545, 0.000, 0.000]},
    {name: 'DarkSalmon',           color: [0.914, 0.588, 0.478]},
    {name: 'DarkSeaGreen',         color: [0.561, 0.737, 0.561]},
    {name: 'DarkSlateBlue',        color: [0.282, 0.239, 0.545]},
    {name: 'DarkSlateGray',        color: [0.184, 0.310, 0.310]},
    {name: 'DarkSlateGrey',        color: [0.184, 0.310, 0.310]},
    {name: 'DarkTurquoise',        color: [0.000, 0.808, 0.820]},
    {name: 'DarkViolet',           color: [0.580, 0.000, 0.827]},
    {name: 'DeepPink',             color: [1.000, 0.078, 0.576]},
    {name: 'DeepSkyBlue',          color: [0.000, 0.749, 1.000]},
    {name: 'DimGray',              color: [0.412, 0.412, 0.412]},
    {name: 'DimGrey',              color: [0.412, 0.412, 0.412]},
    {name: 'DodgerBlue',           color: [0.118, 0.565, 1.000]},
    {name: 'FireBrick',            color: [0.698, 0.133, 0.133]},
    {name: 'FloralWhite',          color: [1.000, 0.980, 0.941]},
    {name: 'ForestGreen',          color: [0.133, 0.545, 0.133]},
    {name: 'Fuchsia',              color: [1.000, 0.000, 1.000]},
    {name: 'Gainsboro',            color: [0.863, 0.863, 0.863]},
    {name: 'GhostWhite',           color: [0.973, 0.973, 1.000]},
    {name: 'Gold',                 color: [1.000, 0.843, 0.000]},
    {name: 'GoldenRod',            color: [0.855, 0.647, 0.125]},
    {name: 'Gray',                 color: [0.502, 0.502, 0.502]},
    {name: 'Grey',                 color: [0.502, 0.502, 0.502]},
    {name: 'Green',                color: [0.000, 0.502, 0.000]},
    {name: 'GreenYellow',          color: [0.678, 1.000, 0.184]},
    {name: 'HoneyDew',             color: [0.941, 1.000, 0.941]},
    {name: 'HotPink',              color: [1.000, 0.412, 0.706]},
    {name: 'IndianRed',            color: [0.804, 0.361, 0.361]},
    {name: 'Indigo',               color: [0.294, 0.000, 0.510]},
    {name: 'Ivory',                color: [1.000, 1.000, 0.941]},
    {name: 'Khaki',                color: [0.941, 0.902, 0.549]},
    {name: 'Lavender',             color: [0.902, 0.902, 0.980]},
    {name: 'LavenderBlush',        color: [1.000, 0.941, 0.961]},
    {name: 'LawnGreen',            color: [0.486, 0.988, 0.000]},
    {name: 'LemonChiffon',         color: [1.000, 0.980, 0.804]},
    {name: 'LightBlue',            color: [0.678, 0.847, 0.902]},
    {name: 'LightCoral',           color: [0.941, 0.502, 0.502]},
    {name: 'LightCyan',            color: [0.878, 1.000, 1.000]},
    {name: 'LightGoldenRodYellow', color: [0.980, 0.980, 0.824]},
    {name: 'LightGray',            color: [0.827, 0.827, 0.827]},
    {name: 'LightGrey',            color: [0.827, 0.827, 0.827]},
    {name: 'LightGreen',           color: [0.565, 0.933, 0.565]},
    {name: 'LightPink',            color: [1.000, 0.714, 0.757]},
    {name: 'LightSalmon',          color: [1.000, 0.627, 0.478]},
    {name: 'LightSeaGreen',        color: [0.125, 0.698, 0.667]},
    {name: 'LightSkyBlue',         color: [0.529, 0.808, 0.980]},
    {name: 'LightSlateGray',       color: [0.467, 0.533, 0.600]},
    {name: 'LightSlateGrey',       color: [0.467, 0.533, 0.600]},
    {name: 'LightSteelBlue',       color: [0.690, 0.769, 0.871]},
    {name: 'LightYellow',          color: [1.000, 1.000, 0.878]},
    {name: 'Lime',                 color: [0.000, 1.000, 0.000]},
    {name: 'LimeGreen',            color: [0.196, 0.804, 0.196]},
    {name: 'Linen',                color: [0.980, 0.941, 0.902]},
    {name: 'Magenta',              color: [1.000, 0.000, 1.000]},
    {name: 'Maroon',               color: [0.502, 0.000, 0.000]},
    {name: 'MediumAquaMarine',     color: [0.400, 0.804, 0.667]},
    {name: 'MediumBlue',           color: [0.000, 0.000, 0.804]},
    {name: 'MediumOrchid',         color: [0.729, 0.333, 0.827]},
    {name: 'MediumPurple',         color: [0.576, 0.439, 0.859]},
    {name: 'MediumSeaGreen',       color: [0.235, 0.702, 0.443]},
    {name: 'MediumSlateBlue',      color: [0.482, 0.408, 0.933]},
    {name: 'MediumSpringGreen',    color: [0.000, 0.980, 0.604]},
    {name: 'MediumTurquoise',      color: [0.282, 0.820, 0.800]},
    {name: 'MediumVioletRed',      color: [0.780, 0.082, 0.522]},
    {name: 'MidnightBlue',         color: [0.098, 0.098, 0.439]},
    {name: 'MintCream',            color: [0.961, 1.000, 0.980]},
    {name: 'MistyRose',            color: [1.000, 0.894, 0.882]},
    {name: 'Moccasin',             color: [1.000, 0.894, 0.706]},
    {name: 'NavajoWhite',          color: [1.000, 0.871, 0.678]},
    {name: 'Navy',                 color: [0.000, 0.000, 0.502]},
    {name: 'OldLace',              color: [0.992, 0.957, 0.902]},
    {name: 'Olive',                color: [0.502, 0.502, 0.000]},
    {name: 'OliveDrab',            color: [0.420, 0.557, 0.137]},
    {name: 'Orange',               color: [1.000, 0.647, 0.000]},
    {name: 'OrangeRed',            color: [1.000, 0.271, 0.000]},
    {name: 'Orchid',               color: [0.855, 0.439, 0.839]},
    {name: 'PaleGoldenRod',        color: [0.933, 0.910, 0.667]},
    {name: 'PaleGreen',            color: [0.596, 0.984, 0.596]},
    {name: 'PaleTurquoise',        color: [0.686, 0.933, 0.933]},
    {name: 'PaleVioletRed',        color: [0.859, 0.439, 0.576]},
    {name: 'PapayaWhip',           color: [1.000, 0.937, 0.835]},
    {name: 'PeachPuff',            color: [1.000, 0.855, 0.725]},
    {name: 'Peru',                 color: [0.804, 0.522, 0.247]},
    {name: 'Pink',                 color: [1.000, 0.753, 0.796]},
    {name: 'Plum',                 color: [0.867, 0.627, 0.867]},
    {name: 'PowderBlue',           color: [0.690, 0.878, 0.902]},
    {name: 'Purple',               color: [0.502, 0.000, 0.502]},
    {name: 'RebeccaPurple',        color: [0.400, 0.200, 0.600]},
    {name: 'Red',                  color: [1.000, 0.000, 0.000]},
    {name: 'RosyBrown',            color: [0.737, 0.561, 0.561]},
    {name: 'RoyalBlue',            color: [0.255, 0.412, 0.882]},
    {name: 'SaddleBrown',          color: [0.545, 0.271, 0.075]},
    {name: 'Salmon',               color: [0.980, 0.502, 0.447]},
    {name: 'SandyBrown',           color: [0.957, 0.643, 0.376]},
    {name: 'SeaGreen',             color: [0.180, 0.545, 0.341]},
    {name: 'SeaShell',             color: [1.000, 0.961, 0.933]},
    {name: 'Sienna',               color: [0.627, 0.322, 0.176]},
    {name: 'Silver',               color: [0.753, 0.753, 0.753]},
    {name: 'SkyBlue',              color: [0.529, 0.808, 0.922]},
    {name: 'SlateBlue',            color: [0.416, 0.353, 0.804]},
    {name: 'SlateGray',            color: [0.439, 0.502, 0.565]},
    {name: 'SlateGrey',            color: [0.439, 0.502, 0.565]},
    {name: 'Snow',                 color: [1.000, 0.980, 0.980]},
    {name: 'SpringGreen',          color: [0.000, 1.000, 0.498]},
    {name: 'SteelBlue',            color: [0.275, 0.510, 0.706]},
    {name: 'Tan',                  color: [0.824, 0.706, 0.549]},
    {name: 'Teal',                 color: [0.000, 0.502, 0.502]},
    {name: 'Thistle',              color: [0.847, 0.749, 0.847]},
    {name: 'Tomato',               color: [1.000, 0.388, 0.278]},
    {name: 'Turquoise',            color: [0.251, 0.878, 0.816]},
    {name: 'Violet',               color: [0.933, 0.510, 0.933]},
    {name: 'Wheat',                color: [0.961, 0.871, 0.702]},
    {name: 'White',                color: [1.000, 1.000, 1.000]},
    {name: 'WhiteSmoke',           color: [0.961, 0.961, 0.961]},
    {name: 'Yellow',               color: [1.000, 1.000, 0.000]},
    {name: 'YellowGreen',          color: [0.604, 0.804, 0.196]}
];



const genColorNameLightness =
[
    {name: 'pale',   value: 0.87},
    {name: 'light',  value: 0.76},
    {name: 'bright', value: 0.65},
    {name: 'deep',   value: 0.35},
    {name: 'dim',    value: 0.22},
    {name: 'dark',   value: 0.12}
];



const genColorNameSaturation =
[
    {name: 'calm',  value: 0.72},
    {name: 'dull',  value: 0.46},
    {name: 'dirty', value: 0.21}
];



const genColorNameHue =
[
    {name: 'violet',  value: 285},
    {name: 'purple',  value: 269},
    {name: 'indigo',  value: 252},
    {name: 'blue',    value: 241},
    {name: 'cobalt',  value: 222},
    {name: 'sky',     value: 211},
    {name: 'aqua',    value: 193},
    {name: 'cyan',    value: 177},
    {name: 'jade',    value: 154},
    {name: 'green',   value: 112},
    {name: 'lime',    value:  74},
    {name: 'yellow',  value:  54},
    {name: 'mango',   value:  42},
    {name: 'orange',  value:  30},
    {name: 'amber',   value:  17},
    {name: 'salmon',  value:  11},
    {name: 'red',     value:   0},
    {name: 'rose',    value: 335},
    {name: 'magenta', value: 310}
];



function getClosestHtmlName(rgb)
{
    let dist  = Number.MAX_SAFE_INTEGER;
    let index = -1;

    for (let i = 0; i < htmlColors.length; i++)
    {
        const dE = deltaE(htmlColors[i].color, rgb);

        if (dE < dist)
        {
            dist  = dE;
            index = i;
        }
    }


    if (index > -1)
        return htmlColors[index].name;


    console.error('cannot find HTML color name for \'' + rgb2hex(rgb) + '\'');
    return '';
}



function parseColorName(name)
{
    if (   name == 'rnd'
        || name == 'random'
        || getEditDistance(name, 'random') <= 1)
    {
        skipRandom(Date.now() % 10);  const r = Math.random();
        skipRandom(Date.now() % 10);  const g = Math.random();
        skipRandom(Date.now() % 10);  const b = Math.random();

        return [r, g, b];
    }
    else
    {
        if (settings.preferHtmlColorNames)
        {
                       let webColor = htmlColors.find(wc => wc.name.toLowerCase() == name);
            if (!webColor) webColor = htmlColors.find(wc => getEditDistance(wc.name.toLowerCase(), name) <= 1);
            
            return webColor.color;//validHex2rgb(e.detail.value);
        }
        else
        {
            const hsl = parseStructuredColorName(name);

            return hsl 
                ? hsl2rgb(hsl) 
                : validHex2rgb(name);
        }
    }
}



function parseStructuredColorNameLightness(name) 
{
    for (const item of genColorNameLightness) 
    {
        if (   name.startsWith(item.name) 
            ||     getEditDistance(name.slice(0, item.name.length), item.name) <= 1
               && !genColorNameHue.find(h => h.name.startsWith(name))) 
        {
            return { value:     item.value, 
                     remaining: name.slice(item.name.length) };
        }
    }

    return { value:     null, 
             remaining: name };
}



function parseStructuredColorNameSaturation(name) 
{
    for (const item of genColorNameSaturation) 
    {
        if (   name.startsWith(item.name) 
            ||     getEditDistance(name.slice(0, item.name.length), item.name) <= 1
               && !genColorNameHue.find(h => h.name.startsWith(name))) 
        {
            return { value:     item.value, 
                     remaining: name.slice(item.name.length) };
        }
    }

    return { value:     null, 
             remaining: name };
}



function parseStructuredColorNameHue(name) 
{
    for (const item of genColorNameHue) 
    {
        if (   name === item.name 
            || getEditDistance(name.slice(0, item.name.length), item.name) <= 1) 
        {
            return item.value;
        }
    }

    return null;
}



function parseStructuredColorName(_colorName) 
{
    let colorName = _colorName.replace(/\s+/g, '');


    if (   colorName === 'black' 
        || getEditDistance(colorName, 'black') <= 1)
        return [0, 0, 0];

    if (   colorName === 'white' 
        || getEditDistance(colorName, 'white') <= 1)
        return [0, 0, 1];

        
    const grayVariants = ['gray', 'grey'];

    let isGray = false;
    let gl     = 0.5;

    for (const grayVariant of grayVariants) 
    {
        if (   colorName.endsWith(grayVariant) 
            || getEditDistance(colorName.slice(-grayVariant.length), grayVariant) <= 1) 
        {
            isGray = true;
        
            const grayPrefix = colorName.slice(0, -grayVariant.length);
            
            if (grayPrefix) 
            {
                const { value } = parseStructuredColorNameLightness(grayPrefix);
                
                if (value !== null) 
                    gl = value;
            }

            break;
        }
    }


    if (isGray)
        return [0, 0, gl];


    let h = null;
    let s = null;
    let l = null;

    
    // try lightness first
    
    let result  = parseStructuredColorNameLightness(colorName);
        l       = result.value;
    let remName = result.remaining;

        result  = parseStructuredColorNameSaturation(remName);
        s       = result.value;
        remName = result.remaining;

        h       = parseStructuredColorNameHue(remName);


    // reset if the first check fails
    // and try saturation first
    
    if (   h === null 
        || s === null 
        || l === null) 
    {
        h = null;
        s = null;
        l = null;

        result  = parseStructuredColorNameSaturation(colorName);
        s       = result.value;
        remName = result.remaining;

        result  = parseStructuredColorNameLightness(remName);
        l       = result.value;
        remName = result.remaining;

        h       = parseStructuredColorNameHue(remName);
    }


    if (h === null) return null; // hue is mandatory
    if (l === null) l = 0.5;
    if (s === null) s = 1.0;

    
    return [h / 360, s, l];
}



function createColorName(rgba)
{
    if (rgba.length > 3 && rgba[3] == 0)
        return 'transparent';


    const hsl = rgb2hsl(rgba);

    let   h = hsl[0] * 360;

    while (h >= 360) h -= 360;
    while (h <    0) h += 360;
    
    const s = hsl[1];
    const l = hsl[2];


         if (l >= 0.94) return 'white';
    else if (l <  0.06) return 'black';


    let strH = '';
    let strS = '';
    let strL = '';


         if (l >= 0.81 && l < 0.94) strL = 'pale ';
    else if (l >= 0.69 && l < 0.81) strL = 'light ';
    else if (l >= 0.56 && l < 0.69) strL = 'bright ';
    else if (l >= 0.31 && l < 0.44) strL = 'deep ';
    else if (l >= 0.19 && l < 0.31) strL = 'dim ';
    else if (l >= 0.06 && l < 0.19) strL = 'dark ';
    

    if (l > 0.25 && l < 0.75) 
    {
             if (s >= 0.62 && s < 0.88) strS = 'calm ';
        else if (s >= 0.31 && s < 0.62) strS = 'dull ';
        else if (s >= 0.12 && s < 0.31) strS = 'dirty ';
    }


    if (s >= 0.12)
    {
             if (h < 293 && h >= 278) strH = 'violet';
        else if (h < 278 && h >= 259) strH = 'purple';
        else if (h < 259 && h >= 248) strH = 'indigo';
        else if (h < 248 && h >= 233) strH = 'blue';
        else if (h < 233 && h >= 221) strH = 'cobalt';
        else if (h < 221 && h >= 201) strH = 'sky';
        else if (h < 201 && h >= 185) strH = 'aqua';
        else if (h < 185 && h >= 169) strH = 'cyan';
        else if (h < 169 && h >= 139) strH = 'jade';
        else if (h < 139 && h >=  86) strH = 'green';
        else if (h <  86 && h >=  63) strH = 'lime';
        else if (h <  63 && h >=  45) strH = 'yellow';
        else if (h <  45 && h >=  40) strH = 'mango';
        else if (h <  40 && h >=  21) strH = 'orange';
        else if (h <  21 && h >=  13) strH = 'amber';
        else if (h <  13 && h >=   8) strH = 'salmon';
        else if (h <   8 || h >= 352) strH = 'red';
        else if (h < 352 && h >= 328) strH = 'rose';
        else if (h < 328 && h >= 293) strH = 'magenta';
        else 
            console.error('error parsing hue name');
    }
    else 
        strH = 'gray';


    return strL + strS + strH;
}
