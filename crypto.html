<html>
    <script src="core/lib.js"></script>
    <script src="core/math.js"></script>
    <script src="core/util.js"></script>
    <script src="core/random.js"></script>
    <script src="core/base32.js"></script>
    <script src="core/base64.js"></script>
    <script src="core/common.js"></script>
    <script src="core/bigmath.js"></script>
    <script src="license/crypto.js"></script>
    <script src="license/license.js"></script>


    <body>
        <p id='text'></p>
    </body>

    <style>
        #text
        {
            font:          11pt Consolas;
            overflow-wrap: break-word;
            word-break:    break-all;
            line-height:   1.5em;
        }
    </style>

    <script>

        let txt = '';


        const id   = getQueryVariable('id');
        const date = getQueryVariable('date'); // DDMMYYYY

        const lic  = createLicenseFromDate(id, date);
        const key  = createLicenseKey(lic);

        // const [p, q] = createCryptoPrimePair(65537n);

        // txt += 'p: ' + p + '<br/>';
        // txt += 'q: ' + q + '<br/><br/>';

        txt += 'User ID:&nbsp;&nbsp;&nbsp;&nbsp; ' + id       + '<br/>';
        txt += 'Tier:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' + lic.tier + '<br/>';
        txt += 'Last date:&nbsp;&nbsp; ' + date     + '<br/><br/>';

        const license = validateLicense(id, key);

        if (   id   != 'false'
            && date != 'false')
            txt += 'License key:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' + key + ' ' + getValidSign(license, key) + '<br/>';

        if (license)
        {
            txt += 'License tier:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' + license.tier + '<br/>';
            txt += 'License last date: ' + license.lastDay.toString().padStart(2, '0') + '/' + license.lastMonth.toString().padStart(2, '0') + '/' + license.lastYear.toString() + '<br/><br/>';
        }


        // const goodKey = key;
        // const badKey  = goodKey.substring(0, goodKey.length-1) + String.fromCharCode(Number(goodKey.charCodeAt(goodKey.length-1))+1);

        // txt += 'validating ' + goodKey + ' ' + (validateLicense(id, goodKey) ? '<font color="green">√</font>' : '<font color="red">X</font>') + '<br/>';
        // txt += 'validating ' +  badKey + ' ' + (validateLicense(id, badKey ) ? '<font color="green">√</font>' : '<font color="red">X</font>');



        text.innerHTML = txt;


        function getValidSign(license, key)
        {
            return !!license
                ? '<font color="green">√</font>' 
                : '<font color="red">X</font>';
        }

    </script>

</html>